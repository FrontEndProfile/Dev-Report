
<html><head><base href="https://websim.dev/developer_daily_report/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer Daily Report</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
      .container {
        background-color: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 500px;
      }
      h1, h2 {
        text-align: center;
        color: #333;
      }
      form {
        display: flex;
        flex-direction: column;
      }
      label {
        margin-top: 10px;
        font-weight: bold;
      }
      input, select, textarea {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }
      button {
        background-color: #4CAF50;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 20px;
      }
      button:hover {
        background-color: #45a049;
      }
      #modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
      }
      .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
      }
      #authButton {
        display: none;
        margin-top: 10px;
      }
    </style>
    </head>
    <body>
      <div class="container">
        <h1>Developer Daily Report</h1>
        <form id="reportForm">
          <label for="task">Task:</label>
          <textarea id="task" name="task" rows="3" required></textarea>
          
          <label for="category">Category:</label>
          <select id="category" name="category" required>
            <option value="">Select a category</option>
            <option value="Bug">Bug</option>
            <option value="R&D">R&D</option>
            <option value="Feature">Feature</option>
          </select>
          
          <label for="date">Date:</label>
          <input type="date" id="date" name="date" required>
          
          <label for="hours">Hours Spent:</label>
          <input type="number" id="hours" name="hours" min="0" step="0.5" required>
          
          <button type="submit">Submit Report</button>
        </form>
        <button id="authButton">Authenticate with Google</button>
      </div>
    
      <div id="modal">
        <div class="modal-content">
          <h2>Connect to Google Sheets</h2>
          <form id="apiForm">
            <label for="clientId">Client ID:</label>
            <input type="text" id="clientId" name="clientId" required>
            
            <label for="apiKey">API Key:</label>
            <input type="text" id="apiKey" name="apiKey" required>
            
            <label for="spreadsheetId">Spreadsheet ID:</label>
            <input type="text" id="spreadsheetId" name="spreadsheetId" required>
            
            <label for="sheetRange">Sheet Range:</label>
            <input type="text" id="sheetRange" name="sheetRange" required placeholder="e.g., Sheet1!A:D">
            
            <button type="submit">Connect</button>
          </form>
        </div>
      </div>
    
      <script src="https://apis.google.com/js/api.js"></script>
      <script src="https://accounts.google.com/gsi/client"></script>
      <script>
        let tokenClient;
        let gapiInited = false;
        let gisInited = false;
    
        document.addEventListener('DOMContentLoaded', function() {
          const modal = document.getElementById('modal');
          const apiForm = document.getElementById('apiForm');
          const reportForm = document.getElementById('reportForm');
          const authButton = document.getElementById('authButton');
    
          // Check if API credentials are stored
          if (!localStorage.getItem('gapi_credentials')) {
            modal.style.display = 'block';
          } else {
            initializeGoogleAPI(JSON.parse(localStorage.getItem('gapi_credentials')));
          }
    
          apiForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const credentials = {
              clientId: document.getElementById('clientId').value,
              apiKey: document.getElementById('apiKey').value,
              spreadsheetId: document.getElementById('spreadsheetId').value,
              sheetRange: document.getElementById('sheetRange').value
            };
            localStorage.setItem('gapi_credentials', JSON.stringify(credentials));
            modal.style.display = 'none';
            initializeGoogleAPI(credentials);
          });
    
          reportForm.addEventListener('submit', function(e) {
            e.preventDefault();
            handleAuthClick();
          });
    
          authButton.addEventListener('click', handleAuthClick);
        });
    
        function initializeGoogleAPI(credentials) {
          gapi.load('client', () => {
            gapi.client.init({
              apiKey: credentials.apiKey,
              discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
            }).then(() => {
              gapiInited = true;
              maybeEnableButtons();
            });
          });
    
          tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: credentials.clientId,
            scope: 'https://www.googleapis.com/auth/spreadsheets',
            callback: '', // defined later
          });
    
          gisInited = true;
          maybeEnableButtons();
        }
    
        function maybeEnableButtons() {
          if (gapiInited && gisInited) {
            document.getElementById('authButton').style.display = 'block';
          }
        }
    
        function handleAuthClick() {
          tokenClient.callback = async (resp) => {
            if (resp.error !== undefined) {
              throw (resp);
            }
            await submitReport();
          };
    
          if (gapi.client.getToken() === null) {
            tokenClient.requestAccessToken({prompt: 'consent'});
          } else {
            tokenClient.requestAccessToken({prompt: ''});
          }
        }
    
        async function submitReport() {
          const credentials = JSON.parse(localStorage.getItem('gapi_credentials'));
          const formData = new FormData(document.getElementById('reportForm'));
          const report = Object.fromEntries(formData.entries());
          
          const taskLines = report.task.split('\n').filter(line => line.trim() !== '');
          const formattedTask = taskLines.length > 1 
            ? taskLines.map(line => `â€¢ ${line}`).join('\n')
            : report.task;
    
          const values = [
            [formattedTask, report.category, report.date, report.hours]
          ];
    
          try {
            const response = await gapi.client.sheets.spreadsheets.values.append({
              spreadsheetId: credentials.spreadsheetId,
              range: credentials.sheetRange,
              valueInputOption: 'USER_ENTERED',
              resource: { values: values }
            });
            console.log('Report submitted:', response);
            alert('Report submitted successfully!');
            document.getElementById('reportForm').reset();
          } catch (error) {
            console.error('Error submitting report:', error);
            alert('Error submitting report. Please try again.');
          }
        }
      </script>
    </body>
    </html>